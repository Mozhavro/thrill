{% extends "base.html" %}

{% load md_tags %}
{% load mptt_tags %}

{% block "content" %}

    {% with post=object %}
        <div class="post">
            <h2 class="post-title">{{ post.title }}</h2>
            {% if post.thumbnail %}
                <img src="{{ post.thumbnail.url }}" alt="">
            {% endif %}
            <div class="post-content">{{ post.content|markdown }}</div>
        </div>

        {% if request.user %}
            {% if post.user %}
                {% if post.user == request.user %}
                    <a href="{% url 'user_post_edit' post.pk %}">Edit</a>
                    <a href="{% url 'user_post_delete' post.pk %}">Delete</a>
                {% endif %}
            {% else %}
                {% if post.community.admin == request.user %}
                    {% if post.community.short_link %}
                        <a href="{% url 'community_post_edit' post.community.short_link post.pk %}">Edit</a>
                        <a href="{% url 'community_post_delete' post.community.short_link post.pk %}">Delete</a>
                    {% else %}
                        <a href="{% url 'community_post_edit' post.community.pk post.pk %}">Edit</a>
                        <a href="{% url 'community_post_delete' post.community.pk post.pk %}">Delete</a>
                    {% endif %}
                {% endif %}
            {% endif %}

            {# TODO comment form #}

            {% with nodes=post.comments.all %}
                <ul class="comments">
                    {% recursetree nodes %}
                        <li>
                            {{ node.content }}
                            {% if not node.is_leaf_node %}
                                <ul class="children">
                                    {{ children }}
                                </ul>
                            {% endif %}
                        </li>
                    {% endrecursetree %}
                </ul>
            {% endwith %}

        {% endif %}
    {% endwith %}
{% endblock %}